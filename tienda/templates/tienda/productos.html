{% extends 'ProyectoWebApp/base.html' %}
{% load static %}

{% block content %}

<style>
  .lupa-container {
    position: relative;
    display: inline-block;
    cursor: zoom-in;
  }

  .lupa-ampliada {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80vw;
    height: 80vh;
    z-index: 1050;
    background-color: rgba(0, 0, 0, 0.85);
    padding: 12px;
    border-radius: 8px;
    display: none;
    overflow: hidden;
    box-shadow: 0 0 20px rgba(0,0,0,0.6);
  }

  .lupa-ampliada img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    border-radius: 4px;
  }

  .lupa-ampliada:after {
    content: "‚úï";
    position: absolute;
    top: 8px;
    right: 12px;
    font-size: 24px;
    color: white;
    cursor: pointer;
  }
</style>


<section class="page-section" style="padding: 0;">
  <div class="container" style="padding-top: 24px;">
    <div class="row">
      <div class="col-md-6 text-center">
        <!-- Imagen principal din√°mica -->
        <div class="lupa-container">
        <img id="imagen-principal"
             src="{{ producto.foto_principal.url }}"
             data-original="{{ producto.foto_principal.url }}"
             alt="{{ producto.nombre }}"
             class="img-fluid rounded shadow-sm mb-3"
             style="max-height: 400px; object-fit: contain; background-color: #f8f9fa;">
        </div>

<div id="lupa" class="lupa-ampliada">
  <img src="{{ producto.foto_principal.url }}" alt="Ampliada">
</div>

        <!-- Galer√≠a de fotos extra -->
        {% if fotos_extra %}
          <div class="d-flex flex-wrap justify-content-center" style="gap: 12px;">
            {% for foto in fotos_extra %}
              <img src="{{ foto.imagen.url }}"
                   alt="{{ foto.descripcion }}"
                   class="img-thumbnail foto-extra"
                   style="width: 140px; height: 140px; object-fit: cover; cursor: pointer;">
            {% endfor %}
          </div>
          <!-- esto pertenece a la funci√≥n volverBtn.addEventListener
          <div class="mt-3 text-center">
            <button id="volver-principal" class="btn btn-sm btn-outline-light">‚Üê Volver a imagen principal</button>
          </div>
          -->
        {% endif %}
      </div>

      <div class="col-md-6">
        <h2 class="text-white">{{ producto.nombre }}</h2>
        {% if producto.disponibilidad %}
          <span class="badge bg-success">Disponible</span>
        {% else %}
          <span class="badge bg-danger">No disponible</span>
        {% endif %}

        <p class="text-white"><strong>Precio:</strong> {{ producto.precio }} ‚Ç¨</p>
        <p class="text-white"><strong>Categor√≠a:</strong> {{ producto.categoria.nombre }}</p>
        <hr class="bg-light">
        <p class="text-white">{{ producto.caracteristicas }}</p>
        
        <!-- Bot√≥n Agregar al carrito -->
        <div class="mt-4 text-center">
          <a href="{% url 'agregar_producto' producto.id %}" class="btn btn-lg btn-warning fw-bold shadow-sm">
            üõí Agregar al carrito
          </a>
        </div>

        <div class="mt-4">
          <a href="{% url 'productos_por_categoria' categoria.id %}" class="btn btn-outline-light">‚Üê Volver a {{ categoria.nombre }}</a>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Script para cambiar imagen principal -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const imagenPrincipal = document.getElementById('imagen-principal');
    const fotosExtra = document.querySelectorAll('.foto-extra');

    fotosExtra.forEach(foto => {
      foto.addEventListener('click', () => {
        imagenPrincipal.src = foto.src;
      });
    });
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const imagenPrincipal = document.getElementById('imagen-principal');
    const lupa = document.getElementById('lupa');
    const volverBtn = document.getElementById('volver-principal');
    const fotosExtra = document.querySelectorAll('.foto-extra');

    const originalSrc = imagenPrincipal.getAttribute('data-original');

    fotosExtra.forEach(foto => {
      foto.addEventListener('click', () => {
        imagenPrincipal.src = foto.src;
        lupa.querySelector('img').src = foto.src;
      });
    });
// Se ha desactivado el bot√≥n 'volver-principal' porque la imagen principal se ha subido tambi√©n a 
// la tabla tienda_fotoextraproducto y hace falta en el futuro
/*    
    volverBtn.addEventListener('click', () => {
      imagenPrincipal.src = originalSrc;
      lupa.querySelector('img').src = originalSrc;
    });
*/    

    imagenPrincipal.addEventListener('click', () => {
      lupa.style.display = 'block';
    });

    lupa.addEventListener('click', () => {
      lupa.style.display = 'none';
    });
  });
</script>


{% endblock %}
