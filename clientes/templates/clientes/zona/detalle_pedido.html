{% extends 'ProyectoWebApp/base.html' %}

{% block content %}
<div class="container mt-5 zona-cliente">
    <h2 style="color: beige;">Detalle del Pedido #{{ pedido.id }}</h2>

    {% if messages %}
      {% for message in messages %}
        <div class="alert-custom">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}

    <!-- Informaci√≥n del pedido -->
    <div class="card mb-4 bg-dark text-light border-secondary">
        <div class="card-header bg-secondary">
            <h5 class="mb-0">Informaci√≥n del Pedido</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Fecha:</strong> {{ pedido.fecha|date:"d/m/Y H:i" }}</p>
                    <p><strong>Total:</strong> {{ pedido.total }}‚Ç¨</p>
                    <p><strong>M√©todo de pago:</strong> {{ pedido.get_metodo_pago_display }}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Estado:</strong> 
                        {% if pedido.enviado %}
                            <span class="badge bg-success">‚úÖ Enviado</span>
                            {% if pedido.fecha_envio %}
                                <br><small>Fecha de env√≠o: {{ pedido.fecha_envio|date:"d/m/Y H:i" }}</small>
                            {% endif %}
                        {% else %}
                            <span class="badge bg-warning text-dark">‚è≥ Pendiente de env√≠o</span>
                        {% endif %}
                    </p>
                    <p><strong>Env√≠o:</strong> 
                        {% if pedido.envio_gratis %}
                            <span class="badge bg-info">üöö Gratis</span>
                        {% else %}
                            {{ pedido.gastos_envio }}‚Ç¨
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Productos del pedido -->
    <div class="card bg-dark text-light border-secondary">
        <div class="card-header bg-secondary">
            <h5 class="mb-0">Productos</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-dark table-striped">
                    <thead>
                        <tr>
                            <th>Producto</th>
                            <th>Cantidad</th>
                            <th>Precio unitario</th>
                            <th>Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for linea in lineas_pedido %}
                        <tr>
                            <td>{{ linea.producto.nombre }}</td>
                            <td>{{ linea.cantidad }}</td>
                            <td>{{ linea.producto.precio }}‚Ç¨</td>
                            <td>{{ linea.subtotal }}‚Ç¨</td>
                        </tr>
                        {% endfor %}
                        <!-- Gastos de env√≠o -->
                        <tr>
                            <td colspan="3"><strong>Gastos de env√≠o</strong></td>
                            <td>
                                {% if pedido.envio_gratis %}
                                    0.00‚Ç¨
                                {% else %}
                                    {{ pedido.gastos_envio }}‚Ç¨
                                {% endif %}
                            </td>
                        </tr>
                        <!-- Total -->
                        <tr style="background-color: #2c3e50;">
                            <td colspan="3"><strong>TOTAL</strong></td>
                            <td><strong>{{ pedido.total }}‚Ç¨</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="mt-4">
        <a href="{% url 'historial_pedidos' %}" class="btn btn-secondary">‚Üê Volver al historial</a>
        <a href="{% url 'tienda' %}" class="btn btn-primary ms-2">Volver a la tienda</a>
    </div>
</div>
{% endblock %}