{% extends "admin/change_list.html" %}
{% load i18n %}

{% block content %}
  <form method="get" class="form-inline" style="margin-bottom: 20px;">
    <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">

      <div class="form-row">
        <label for="id_provincia">Provincia:</label><br>
        <select name="provincia" id="id_provincia" class="vTextField" style="min-width: 160px;">
          <option value="">Todas</option>
          {% for prov in provincias %}
            <option value="{{ prov }}" {% if request.GET.provincia == prov %}selected{% endif %}>{{ prov }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="form-row">
        <label for="id_localidad">Localidad:</label><br>
        <select name="localidad" id="id_localidad" class="vTextField" style="min-width: 160px;">
          <option value="">Todas</option>
          {% for loc in localidades %}
            <option value="{{ loc }}" {% if request.GET.localidad == loc %}selected{% endif %}>{{ loc }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="form-row">
        <label for="id_fecha_antiguedad_inicio">Antigüedad desde:</label><br>
        <input type="date" name="fecha_antiguedad_inicio" id="id_fecha_antiguedad_inicio"
              value="{{ request.GET.fecha_antiguedad_inicio }}" class="vDateField" style="min-width: 160px;">
      </div>

      <div class="form-row">
        <label for="id_fecha_antiguedad_fin">Antigüedad hasta:</label><br>
        <input type="date" name="fecha_antiguedad_fin" id="id_fecha_antiguedad_fin"
              value="{{ request.GET.fecha_antiguedad_fin }}" class="vDateField" style="min-width: 160px;">
      </div>

      <div class="form-row">
        <label for="id_fecha_cambio_inicio">Último cambio desde:</label><br>
        <input type="date" name="fecha_cambio_inicio" id="id_fecha_cambio_inicio"
              value="{{ request.GET.fecha_cambio_inicio }}" class="vDateField" style="min-width: 160px;">
      </div>

      <div class="form-row">
        <label for="id_fecha_cambio_fin">Último cambio hasta:</label><br>
        <input type="date" name="fecha_cambio_fin" id="id_fecha_cambio_fin"
              value="{{ request.GET.fecha_cambio_fin }}" class="vDateField" style="min-width: 160px;">
      </div>
     
      <div style="display: flex; gap: 10px; align-items: center;">
        <button type="submit" class="button" style="min-width: 100px; padding: 6px 12px; font-weight: bold; text-align: center; margin-top: 24px;">
          Filtrar
        </button>
        <a href="." class="button cancel-link" style="min-width: 100px; padding: 6px 12px; font-weight: bold; text-align: center; margin-top: 24px;">
          Limpiar
        </a>
      </div>

    </div>
  </form>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const provinciaSelect = document.getElementById('id_provincia');
    const localidadSelect = document.getElementById('id_localidad');

    provinciaSelect.addEventListener('change', function () {
      const provincia = this.value;
      fetch(`/clientes/admin/clientes/localidades/?provincia=${encodeURIComponent(provincia)}`)
        .then(response => response.json())
        .then(data => {
          localidadSelect.innerHTML = '<option value="">Todas</option>';
          data.localidades.forEach(loc => {
            const option = document.createElement('option');
            option.value = loc;
            option.textContent = loc;
            localidadSelect.appendChild(option);
          });
        });
    });
  });
</script>
  {{ block.super }}
{% endblock %}
